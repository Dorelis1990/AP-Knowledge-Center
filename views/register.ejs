<!DOCTYPE html>
<html lang="en">
  <%- include("layouts/header") %>
  <body>
    <%- include("layouts/navbar") %>

    <!-- Verification Message Modal -->
    <% if (verifyMessage) { %>
      <div id="verifyModal" class="modal" style="
        display: block; 
        position: fixed; 
        z-index: 9999; 
        left: 0; top: 0; width: 100%; height: 100%; 
        background-color: rgba(0,0,0,0.5);
      ">
        <div style="
          background: white; 
          margin: 15% auto; 
          padding: 20px; 
          max-width: 400px; 
          border-radius: 8px; 
          text-align: center;
        ">
          <p><%= verifyMessage %></p>
          <button onclick="document.getElementById('verifyModal').style.display='none'" 
            class="btn btn-primary">
            Close
          </button>
        </div>
      </div>
    <% } %>

    <!-- Page Header-->
    <header class="masthead" style="background-image: url('/img/password.png')">
      <div class="container position-relative px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
          <div class="col-md-10 col-lg-8 col-xl-7">
            <div class="page-heading">
              <h1>Register a new account</h1>
              <span class="subheading"></span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content-->
    <main class="mb-4">
      <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
          <div class="col-md-10 col-lg-8 col-xl-7">
            <div class="my-5">
              <form action="/users/register" method="POST" id="registerForm" novalidate>
                <!-- Compass Email Field -->
                <div class="form-floating mb-3">
                  <input
                    class="form-control"
                    id="username"
                    name="username"
                    type="text"
                    placeholder="Compass email address..."
                    required
                    pattern="^[^@\s]+@compass\.com$"
                    title="Email must be a valid Compass email ending with @compass.com"
                  />
                  <label for="username">Compass Email Address</label>
                  <div class="invalid-feedback">
                    Please enter a valid Compass email address (e.g. name@compass.com).
                  </div>
                </div>

                <!-- Password Field -->
                <div class="form-floating mb-3">
                  <input
                    class="form-control"
                    id="password"
                    name="password"
                    type="password"
                    placeholder="Password"
                    required
                    pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$"
                    title="Password must be at least 8 characters long and contain both letters and numbers."
                  />
                  <label for="password">Password</label>
                  <div class="invalid-feedback">
                    Password must be at least 8 characters and contain both letters and numbers.
                  </div>
                </div>

                <!-- Submit Button -->
                <button class="btn btn-primary text-uppercase" type="submit">Register</button>

                <!-- Custom Client-side Validation Script -->
                <script>
                  document.getElementById("registerForm").addEventListener("submit", function (e) {
                    const form = e.target;
                    if (!form.checkValidity()) {
                      e.preventDefault();
                      e.stopPropagation();
                      form.classList.add("was-validated");
                    }
                  });
                </script>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>

    <%- include("layouts/footer") %>
    <%- include("layouts/scripts") %>
  </body>
</html>
